/**
 ******************************************************************************
 * @file           : main.c
 * @author         : Tran Ba Thanh
 * @brief          : Main program body
 ******************************************************************************
 * @attention
 *
 * Copyright (c) 2024 STMicroelectronics.
 * All rights reserved.
 *
 * This software is licensed under terms that can be found in the LICENSE file
 * in the root directory of this software component.
 * If no LICENSE file comes with this software, it is provided AS-IS.
 *
 ******************************************************************************
 */

#include <stdint.h>

#include <stdint.h>
// #include "PLL.h"
// #include "SysTick.h"

// portB registers
#define GPIO_B_BASE			(0x40010C00)
#define GPIO_B_CRL			(GPIO_B_BASE + 0x00)
#define GPIO_B_CRH			(GPIO_B_BASE + 0x04)
//#define GPIO_B_IDR			(GPIO_B_BASE + 0x08)
#define GPIO_B_ODR			(GPIO_B_BASE + 0x0C)

// portA registers
#define GPIO_A_BASE			(0x40010800)
#define GPIO_A_CRL			(GPIO_A_BASE + 0x00)
#define GPIO_A_IDR			(GPIO_A_BASE + 0x08)
#define GPIO_A_ODR			(GPIO_A_BASE + 0x0C)

//  RCC clock registers
#define RCC_BASE			(0x40021000)
#define RCC_APB2ENR         (RCC_BASE + 0x18)

// states
#define jSo		0
#define wSo		1
#define rSo		2
#define	jWe		3
#define wWe		4
#define rWe		5
#define jWa		6
#define wWa		7
#define rWa		8
#define rAl		9

// state Structure
struct State
{
	uint32_t OutB;		// 6-bit output for port B
	uint32_t OutA;		// 3-bit output for port A, 1 output will be fake output to trigger a function
	uint32_t Time;		// x10 ms
	uint8_t Next[8];	// depends on 3-bit input
};

// Blink of walk need to look into more!!
// FSM of states
typedef const struct State STyp;
STyp FSM[10]={
	// jSo : just South
	{0x0C0,0x20,1000,{waitN,waitN,goN,waitN,waitN,waitN,waitN,waitN}},
	// wSo : wait South
	{0x0A0,0x20,160,{waitSafetyN,waitSafetyN,waitSafetyE,waitSafetyN,walkN,walkN,walkN,walkN}},
	// rSo : red South
	{0x090,0x20,80,{}},
	// jWe : just West
	{0x210,0x20,400,{}},
	// wWe : wait West
	{0x110,0x20,200,{}},
	// rWe : red West
	{0x090,0x20,400,{}},
	// jWa : just Walk
	{0x090,0x10,160,{}},
	// wWa : wait Walk
	{0x090,0x30,80,{}},
	// rWa : red Walk
	{0x090,0x20,400,{}},
	// rAl : red All
	{0x090,0x20,200,{}}
};

// initialize port B
void portB_Init(void)
{

}

int main(void)
{
	// Enable RCC for GPIO
	*RCC_APB2ENR |= 0x0C;
    /* Loop forever */
	for(;;);
}
